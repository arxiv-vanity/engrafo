#!/usr/bin/env node

var engrafo = require("../src");
var path = require("path");
var fs = require("fs");
var program = require("commander");

program
  .version("0.0.1")
  .usage("[options] <tex file>")
  .option(
    "-o, --output <dir>",
    "Output directory (default: same as tex file)"
  )
  .option(
    "--no-post-processing",
    "Raw LaTeXML output, without filters or postprocessors (for debugging)"
  )
  .parse(process.argv);

if (program.args.length != 1) {
  program.outputHelp();
  process.exit(1);
}

var input = program.args[0];
var output = program.output ||
    (fs.lstatSync(input).isDirectory()
     ? input : path.dirname(input));

var options = {
  input: input,
  output: output,
  postProcessing: program.postProcessing
};

engrafo.render(options).then(htmlPath => {
  console.log("ðŸ’ƒ  Document successfully rendered to", htmlPath);
  // S3 library sometimes causes Node not to quit
  process.exit(0);
}).catch(err => {
  console.error("Engrafo rendering failed:", err);
  process.exit(1);
});
